import sys
import requests

url = "https://en.wikipedia.org/w/api.php"

def fetch_rev(name):
    headers = {"User-Agent": "wiki-recent-script/1.0"}

    try:
        response = requests.get(url,params={
                "action": "query",
                "format": "json",
                "prop": "revisions",
                "titles": name,
                "rvprop": "timestamp|user",
                "rvlimit": "30",
                "rvdir": "newer",
                "redirects": 1,
            },
            headers=headers,
            timeout=10
        )
        response.raise_for_status()
        return response.json()

    except requests.RequestException as e:
        print(f"Error fetching data for {name}: {e}", file=sys.stderr)
        sys.exit(3)


def process_response(data):
     query = data.get("query", {})

     ###Rediredct Handling###
     redirected_to = None
     if "redirects" in query:
         redirected_to = query["redirects"][0]["to"]
         print(f"Note: Page was redirected to '{redirected_to}'")
